<script>
  // Proje verilerini Jekyll'dan alıp JS'e aktarmak için
  const allProjectsData = {
    {% assign s_global_js = site.data.strings %}
    tr: {
      projects: [
        {% assign base_project_path_tr = '_projects/tr/' %}
        {% assign projects_tr_modal_js = site.projects | where_exp: "item", "item.path contains base_project_path_tr" %}
        {% for p_tr_modal_js in projects_tr_modal_js %}
        {
          id: "{{ p_tr_modal_js.id | slugify }}",
          title: "{{ p_tr_modal_js.title | escape_once }}",
          content: {{ p_tr_modal_js.content | strip_newlines | jsonify }},
          tags: {{ p_tr_modal_js.tags | jsonify }},
          github: "{{ p_tr_modal_js.github_url }}",
          live: "{{ p_tr_modal_js.live_url }}"
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    },
    en: {
      projects: [
        {% assign base_project_path_en = '_projects/en/' %}
        {% assign projects_en_modal_js = site.projects | where_exp: "item", "item.path contains base_project_path_en" %}
        {% for p_en_modal_js in projects_en_modal_js %}
        {
          id: "{{ p_en_modal_js.id | slugify }}",
          title: "{{ p_en_modal_js.title | escape_once }}",
          content: {{ p_en_modal_js.content | strip_newlines | jsonify }},
          tags: {{ p_en_modal_js.tags | jsonify }},
          github: "{{ p_en_modal_js.github_url }}",
          live: "{{ p_en_modal_js.live_url }}"
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    }
  };
  
  console.log("MODAL SCRIPTS: allProjectsData object initialized:", JSON.parse(JSON.stringify(allProjectsData)));
  
  const modalContentEl = document.getElementById('modalContent');
  const modalTagsEl = document.getElementById('modalTags');
  const modalGithubEl = document.getElementById('modalGithub');
  const modalLiveEl = document.getElementById('modalLive');
  const projectModal = document.getElementById('projectModal');
  const projectModalContentContainer = document.getElementById('projectModalContentContainer'); // İç container'ı da seçelim
  const modalTitleEl = document.getElementById('modalTitle');

  console.log("MODAL SCRIPTS: Modal HTML elements obtained:",
      { projectModal, modalTitleEl, modalContentEl, modalTagsEl, modalGithubEl, modalLiveEl }
  );
  
  function openProjectModal(projectId, lang) {
    console.log("MODAL SCRIPTS: openProjectModal function CALLED with projectId:", projectId, " lang:", lang);

    if (!projectModal || !projectModalContentContainer || !modalTitleEl || !modalContentEl || !modalTagsEl || !modalGithubEl || !modalLiveEl) {
        console.error("MODAL SCRIPTS: ERROR - One or more essential modal HTML elements are missing from the DOM.");
        return;
    }

    const currentLangProjectData = allProjectsData[lang];
    console.log("MODAL SCRIPTS: Data for selected language (" + lang + "):", currentLangProjectData);

    if (!currentLangProjectData || !currentLangProjectData.projects) {
        console.error("MODAL SCRIPTS: ERROR - Project data for language '" + lang + "' not found or invalid in allProjectsData.");
        projectModal.classList.add('opacity-0', 'pointer-events-none');
        projectModalContentContainer.classList.add('scale-95');
        return;
    }

    const project = currentLangProjectData.projects.find(p => p.id === projectId);
    console.log("MODAL SCRIPTS: Project found by ID '" + projectId + "':", project);

    if (project) { // Sadece 'project' null/undefined değilse devam et
        console.log("MODAL SCRIPTS: Project object is valid. Populating and showing modal.");
        modalTitleEl.textContent = project.title || "Title Not Available";
        modalContentEl.innerHTML = project.content || "<p>Content Not Available.</p>";

        modalTagsEl.innerHTML = '';
        if (project.tags && project.tags.length > 0) {
            console.log("MODAL SCRIPTS: Populating tags:", project.tags);
            project.tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'px-3 py-1 bg-ctp-sky/20 text-ctp-sky rounded-full text-xs';
                tagElement.textContent = tag;
                modalTagsEl.appendChild(tagElement);
            });
        } else {
            console.log("MODAL SCRIPTS: No tags for this project.");
        }

        modalGithubEl.href = project.github || '#';
        modalLiveEl.href = project.live || '#';

        modalGithubEl.style.display = project.github ? 'inline-flex' : 'none';
        modalLiveEl.style.display = project.live ? 'inline-flex' : 'none';
        console.log("MODAL SCRIPTS: GitHub link display:", modalGithubEl.style.display, " Live link display:", modalLiveEl.style.display);

        projectModal.classList.remove('opacity-0', 'pointer-events-none');
        projectModalContentContainer.classList.remove('scale-95');
        projectModal.classList.add('opacity-100');
        projectModalContentContainer.classList.add('scale-100');

        document.body.style.overflow = 'hidden';
        console.log("MODAL SCRIPTS: Modal should be visible and animated now.");

    } else {
        console.error("MODAL SCRIPTS: ERROR - Project with ID '"+ projectId +"' NOT FOUND in language '" + lang + "'. Or modal HTML elements are missing.");
        console.error("MODAL SCRIPTS: Details - project (should be null/undefined):", project);
        projectModal.classList.add('opacity-0', 'pointer-events-none');
        projectModalContentContainer.classList.add('scale-95');
    }
}
function closeProjectModal() {
  console.log("MODAL SCRIPTS: closeProjectModal function CALLED."); // Bu mesajı görmelisiniz

  if (projectModal && projectModalContentContainer) {
      console.log("MODAL SCRIPTS: Closing modal - applying opacity and scale transitions.");
      projectModal.classList.add('opacity-0'); // Şeffaflaştır
      projectModalContentContainer.classList.add('scale-95'); // Küçült

      // Transition bittikten sonra pointer-events'i ayarla ve body scroll'u aç
      // setTimeout süresi Tailwind'deki duration-300 ile eşleşmeli (300ms)
      setTimeout(() => {
          console.log("MODAL SCRIPTS: Closing modal - transition ended, setting pointer-events and body overflow.");
          projectModal.classList.add('pointer-events-none'); // Tıklanamaz yap
          // Modal'ı DOM'dan kaldırmak veya display:none yapmak yerine,
          // bir sonraki açılışta animasyonun düzgün çalışması için
          // sadece opacity ve pointer-events ile yönetmek genellikle daha iyidir.
          // Eğer `openProjectModal` içinde `flex` ekliyorsanız, burada `remove('flex')` yapabilirsiniz,
          // ancak `pointer-events-none` ve `opacity-0` zaten onu etkileşim dışı bırakır.
          // projectModal.classList.remove('flex'); // Eğer display:flex ekliyorsanız ve kaldırmak istiyorsanız
          document.body.style.overflow = 'auto'; // Sayfa kaydırmayı geri getir
      }, 300); // Tailwind transition süresiyle (duration-300) eşleşmeli
  } else {
      console.error("MODAL SCRIPTS: ERROR in closeProjectModal - projectModal or projectModalContentContainer is null.");
  }
}

// Modal dışına tıklayınca kapat
if (projectModal) {
  console.log("MODAL SCRIPTS: Adding click listener to projectModal for closing.");
  projectModal.addEventListener('click', (e) => {
      // Sadece modalın kendisine (arka plana) tıklandığında kapat, içindeki content'e değil.
      if (e.target.id === 'projectModal') {
          console.log("MODAL SCRIPTS: Click outside modal content detected, closing modal.");
          closeProjectModal();
      }
  });
} else {
  console.error("MODAL SCRIPTS: ERROR - projectModal element not found, cannot add click listener for closing.");
}

// Escape tuşu ile kapat
console.log("MODAL SCRIPTS: Adding keydown listener to document for Escape key.");
document.addEventListener('keydown', (e) => {
  // Modal görünür durumdaysa ve Escape tuşuna basıldıysa kapat
  if (e.key === 'Escape' && projectModal && !projectModal.classList.contains('opacity-0')) { // opacity-0 değilse görünür kabul edelim
      console.log("MODAL SCRIPTS: Escape key pressed, closing modal.");
      closeProjectModal();
  }
});

console.log("MODAL SCRIPTS: Event listeners for close should be attached now.");
  </script>