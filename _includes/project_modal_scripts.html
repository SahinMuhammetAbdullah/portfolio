<script>
  // Proje verilerini Jekyll'dan alıp JS'e aktarmak için
  const allProjectsData = {
    {% assign s_global = site.data.strings %}
    tr: {
      projects: [
        {% assign projects_tr_modal = site.projects | where_exp: "item", "item.path contains '/_projects/tr/'" %}
        {% for p_tr_modal in projects_tr_modal %}
        {
          id: "{{ p_tr_modal.id | slugify }}",
          title: "{{ p_tr_modal.title | escape_once }}",
          content: {{ p_tr_modal.content | strip_newlines | jsonify }}, // jsonify, stringi JS için uygun hale getirir
          tags: {{ p_tr_modal.tags | jsonify }},
          github: "{{ p_tr_modal.github_url }}",
          live: "{{ p_tr_modal.live_url }}"
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    },
    en: {
      projects: [
        {% assign projects_en_modal = site.projects | where_exp: "item", "item.path contains '/_projects/en/'" %}
        {% for p_en_modal in projects_en_modal %}
        {
          id: "{{ p_en_modal.id | slugify }}",
          title: "{{ p_en_modal.title | escape_once }}",
          content: {{ p_en_modal.content | strip_newlines | jsonify }},
          tags: {{ p_en_modal.tags | jsonify }},
          github: "{{ p_en_modal.github_url }}",
          live: "{{ p_en_modal.live_url }}"
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    }
  };
  
  // DEBUG: allProjectsData'yı konsola yazdır
  // console.log("allProjectsData:", JSON.stringify(allProjectsData, null, 2));
  
  const projectModal = document.getElementById('projectModal');
  const modalTitleEl = document.getElementById('modalTitle');
  const modalContentEl = document.getElementById('modalContent');
  const modalTagsEl = document.getElementById('modalTags');
  const modalGithubEl = document.getElementById('modalGithub');
  const modalLiveEl = document.getElementById('modalLive');
  
  function openProjectModal(projectId, lang) {
      // DEBUG: openProjectModal çağrıldı
      // console.log("openProjectModal called with projectId:", projectId, " lang:", lang);
  
      // Dil verisini al, eğer yoksa varsayılan dili veya 'tr'yi kullan
      const currentLangProjectData = allProjectsData[lang] || allProjectsData['{{ site.default_lang }}'] || allProjectsData['tr'];
      
      if (!currentLangProjectData || !currentLangProjectData.projects) {
          console.error("Project data for language '" + lang + "' not found or invalid in allProjectsData.");
          if (projectModal) projectModal.classList.add('hidden'); // Hata durumunda modalı gizle
          return;
      }
  
      const project = currentLangProjectData.projects.find(p => p.id === projectId);
      // DEBUG: Bulunan proje
      // console.log("Found project:", project);
  
      if (project && projectModal && modalTitleEl && modalContentEl && modalTagsEl && modalGithubEl && modalLiveEl) {
          modalTitleEl.textContent = project.title;
          // İçeriği HTML olarak ayarlıyoruz, çünkü .md dosyasındaki body zaten HTML'e çevrilmiş olmalı
          modalContentEl.innerHTML = project.content;
          
          modalTagsEl.innerHTML = ''; // Önceki etiketleri temizle
          if (project.tags && project.tags.length > 0) {
              project.tags.forEach(tag => {
                  const tagElement = document.createElement('span');
                  // Etiketlerin renklerini dinamik yapabilir veya sabit bir renk kullanabilirsiniz
                  tagElement.className = 'px-3 py-1 bg-ctp-sky/20 text-ctp-sky rounded-full text-xs';
                  tagElement.textContent = tag;
                  modalTagsEl.appendChild(tagElement);
              });
          }
          
          modalGithubEl.href = project.github || '#';
          modalLiveEl.href = project.live || '#';
  
          // Linkleri sadece URL varsa göster
          modalGithubEl.style.display = project.github ? 'inline-flex' : 'none'; // inline-flex kullandım, ikon varsa daha iyi olur
          modalLiveEl.style.display = project.live ? 'inline-flex' : 'none';
          
          projectModal.classList.remove('hidden');
          projectModal.classList.add('flex'); // flex ile ortalamak için
          document.body.style.overflow = 'hidden'; // Arka plan kaymasını engelle
      } else {
          console.error("Project data for ID '"+ projectId +"' not found OR modal HTML elements are missing.");
          if (projectModal) projectModal.classList.add('hidden');
      }
  }
  
  function closeProjectModal() {
      if (projectModal) {
          projectModal.classList.add('hidden');
          projectModal.classList.remove('flex');
          document.body.style.overflow = 'auto'; // Kaymayı geri getir
      }
  }
  
  // Modal dışına tıklayınca kapat
  if (projectModal) {
      projectModal.addEventListener('click', (e) => {
          if (e.target.id === 'projectModal') {
              closeProjectModal();
          }
      });
  }
  
  // Escape tuşu ile kapat
  document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && projectModal && !projectModal.classList.contains('hidden')) {
          closeProjectModal();
      }
  });
  </script>